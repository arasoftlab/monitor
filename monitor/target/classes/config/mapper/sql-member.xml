<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd"> 
<mapper namespace="member">
    
    
    
	<select id="checkMember" parameterType="seoul.member.MemberVO" resultType="seoul.member.MemberVO">
	    select id
	    	  ,password
	    	  ,name
	    	  ,grade
	    	  ,poll_num
	      from member
	     where id=#{id}
	       and password=#{password}
	</select>
	
	<select id="getMember" parameterType="seoul.member.MemberVO" resultType="seoul.member.MemberVO">
	    select id
	    	  ,password
	    	  ,name
	    	  ,grade
	    	  ,poll_num
	    	  ,phone
	    	  ,sido 
	    	  ,gugun
	    	  ,job
	    	  ,sex
	    	  ,dong
	      from member
	     where 1=1
	        	        
	        <if test="query != null and query !=''">
		   		and ${query} 
			</if>	     
	</select>
	
	<select id="getMemberList" parameterType="seoul.member.MemberVO" resultType="seoul.member.MemberVO">
     select * from (
	    select id
	    	  ,password
	    	  ,name
       		  ,row_number() over (order by id) rn
	    	  ,grade
	    	  ,poll_num
	    	  ,phone
	      from member
	     where 1=1
	        	        
	        <if test="query != null and query !=''">
		   		and ${query} 
			</if>
   		)
        where rn between #{pagingVO.startRow} and #{pagingVO.nextPageRow}    	     
	</select>
	
	<select id="getMemberCnt" parameterType="seoul.member.MemberVO" resultType="java.lang.Integer">
   		select count(*)
          from member
         where 1=1

		<if test="searchCategory != null and searchCategory != ''">
      	   and ${searchCategory} like '%' || #{searchText} || '%'
		</if>			
			
		<if test="query != null and query !=''">
		   and ${query} 
		</if>
    </select>
    
	<select id="checkId" parameterType="seoul.member.MemberVO" resultType="java.lang.Integer">
	    select count(*)
	      from member
	     where id=#{id}
	</select>
	
	<update id="updateMember" parameterType="seoul.member.MemberVO">
	    update member
	       set id=#{id,jdbcType=VARCHAR}
	          ,password=#{password,jdbcType=VARCHAR}
	          ,name=#{name,jdbcType=VARCHAR}
	          ,phone=#{phone,jdbcType=VARCHAR}
	     where id=#{id,jdbcType=VARCHAR}
	</update>
	
	<update id="updateMemberETC" parameterType="seoul.member.MemberVO">
	    update member
	       set sido=#{sido,jdbcType=VARCHAR}
	       ,gugun=#{gugun,jdbcType=VARCHAR}
	       ,dong=#{dong,jdbcType=VARCHAR}
	       ,job=#{job,jdbcType=VARCHAR}
	       ,sex=#{sex,jdbcType=VARCHAR}
	     where id=#{id,jdbcType=VARCHAR}
	</update>
	
    <delete id="deleteMember" parameterType="seoul.admin.vo.AnswersVO">
        delete
          from member
         where id=#{id}
    </delete>
	
	<insert id="insertMember" parameterType="seoul.member.MemberVO">
		insert into member(
				id
				,password
				,name
				,grade
				,phone)
		values(
				#{id ,jdbcType=VARCHAR}
				,#{password ,jdbcType=VARCHAR}
				,#{name ,jdbcType=VARCHAR}
				,#{grade ,jdbcType=VARCHAR}
				,#{phone ,jdbcType=VARCHAR})
	</insert>
	
	<insert id="insertJoinMember" parameterType="seoul.member.MemberVO">
		insert into member(
				id
				,grade
				,sex
				,job
				,sido
				,gugun
				,dong
		)
		values(
				#{id ,jdbcType=VARCHAR}
				,#{grade ,jdbcType=VARCHAR}
				,#{sex ,jdbcType=VARCHAR}
				,#{job ,jdbcType=VARCHAR}
				,#{sido ,jdbcType=VARCHAR}
				,#{gugun ,jdbcType=VARCHAR}
				,#{dong ,jdbcType=VARCHAR}				
		)
	</insert>
	
	
	
	<!-- 
	예상 매퍼 
	이름이 제각각이니까 잘 체크할것. 
	 -->
	<select id="getBackEndMember" parameterType="seoul.member.MemberVO" resultType="seoul.member.MemberVO">
	    select id
	    	  ,name
	    	  ,phone
	    	  ,email
	    	  ,sido 
	    	  ,gugun
	    	  ,job
	    	  ,sex
	    	  ,dong
	      from hisip.vw_mem001_m_monitor@sip2
	     where 1=1
	        	        
	        <if test="query != null and query !=''">
		   		and ${query} 
			</if>	     
	</select>
	
	
	
	
	
</mapper>